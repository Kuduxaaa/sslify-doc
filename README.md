# рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃљ: SSL рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃћрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃўрЃАрЃљ рЃЊрЃљ рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃўрЃА рЃърЃарЃЮрЃбрЃЮрЃЎрЃЮрЃџрЃў

## 1. рЃерЃћрЃАрЃљрЃЋрЃљрЃџрЃў

рЃгрЃўрЃюрЃљрЃЏрЃЊрЃћрЃЉрЃљрЃарЃћ рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃў рЃљрЃдрЃгрЃћрЃарЃА WAF (Web Application Firewall) рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃАрЃЌрЃЋрЃўрЃА SSL/TLS рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃћрЃЉрЃўрЃА рЃњрЃљрЃфрЃћрЃЏрЃўрЃАрЃљ рЃЊрЃљ рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃўрЃА рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃўрЃќрЃћрЃЉрЃБрЃџ рЃърЃарЃЮрЃфрЃћрЃАрЃА. рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃЊрЃљрЃърЃарЃЮрЃћрЃЦрЃбрЃћрЃЉрЃБрЃџрЃўрЃљ рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃљрЃЊрЃљрЃЏрЃўрЃљрЃюрЃБрЃарЃў рЃЕрЃљрЃарЃћрЃЋрЃўрЃАрЃЌрЃЋрЃўрЃА рЃЊрЃљ рЃўрЃДрЃћрЃюрЃћрЃЉрЃА рЃўрЃюрЃЊрЃБрЃАрЃбрЃарЃўрЃљрЃерЃў рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃБрЃџ рЃўрЃюрЃАрЃбрЃарЃБрЃЏрЃћрЃюрЃбрЃћрЃЉрЃА, рЃарЃЮрЃњрЃЮрЃарЃћрЃЉрЃўрЃфрЃљрЃљ `certbot`, BIND9 рЃЊрЃљ `HAProxy`.

рЃЏрЃЌрЃћрЃџрЃў рЃърЃарЃЮрЃфрЃћрЃАрЃў рЃўрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ рЃфрЃћрЃюрЃбрЃарЃљрЃџрЃўрЃќрЃћрЃЉрЃБрЃџрЃљрЃЊ, DNS рЃАрЃћрЃарЃЋрЃћрЃарЃўрЃЊрЃљрЃю рЃЊрЃљ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃљрЃюрЃљрЃгрЃўрЃџрЃћрЃЉрЃА рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџ рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃћрЃЉрЃА Load Balancer-рЃўрЃА рЃЎрЃЋрЃљрЃюрЃФрЃћрЃЉрЃќрЃћ.

---

## 2. рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљ рЃЊрЃљ рЃАрЃљрЃЏрЃБрЃерЃљрЃЮ рЃърЃарЃЮрЃфрЃћрЃАрЃў

рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃЏрЃБрЃерЃљрЃЮрЃЉрЃўрЃА рЃфрЃўрЃЎрЃџрЃў рЃерЃћрЃЊрЃњрЃћрЃЉрЃљ рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃћрЃбрЃљрЃърЃћрЃЉрЃўрЃАрЃњрЃљрЃю:

1.  **рЃърЃарЃЮрЃфрЃћрЃАрЃўрЃА рЃўрЃюрЃўрЃфрЃўрЃарЃћрЃЉрЃљ:** рЃърЃарЃЮрЃфрЃћрЃАрЃў рЃўрЃгрЃДрЃћрЃЉрЃљ DNS рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ рЃњрЃљрЃюрЃЌрЃљрЃЋрЃАрЃћрЃЉрЃБрЃџрЃў рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃЏрЃЏрЃљрЃарЃЌрЃЋрЃћрЃџрЃў рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃўрЃЌ.

2.  **рЃЊрЃЮрЃЏрЃћрЃюрЃћрЃЉрЃўрЃА рЃљрЃдрЃЏрЃЮрЃЕрЃћрЃюрЃљ:** рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃБрЃЎрЃљрЃЋрЃерЃўрЃарЃЊрЃћрЃЉрЃљ рЃърЃарЃЮрЃЊрЃљрЃЦрЃерЃћрЃюрЃўрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃЉрЃљрЃќрЃљрЃА (`CSG_waf`) рЃЊрЃљ SQL рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃўрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃўрЃЌ рЃўрЃдрЃћрЃЉрЃА рЃўрЃЏ рЃЋрЃћрЃЉрЃАрЃљрЃўрЃбрЃћрЃЉрЃўрЃА рЃАрЃўрЃљрЃА, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф рЃљрЃЦрЃбрЃўрЃБрЃарЃўрЃљ рЃЊрЃљ рЃАрЃљрЃГрЃўрЃарЃЮрЃћрЃЉрЃА SSL рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃА (`is_verified=1`).

3.  **рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃўрЃА рЃњрЃљрЃфрЃћрЃЏрЃљ (рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃЊрЃЮрЃЏрЃћрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА):**
    * рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА `certbot`-рЃА `DNS-01` рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃўрЃА рЃЏрЃћрЃЌрЃЮрЃЊрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ. рЃћрЃА рЃЏрЃћрЃЌрЃЮрЃЊрЃў рЃљрЃа рЃЏрЃЮрЃўрЃЌрЃ«рЃЮрЃЋs рЃЋрЃћрЃЉ-рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ рЃгрЃЋрЃЊрЃЮрЃЏрЃљрЃА.
    * `certbot` рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃБрЃерЃЋрЃћрЃЉрЃА `auth-hook` рЃАрЃЎрЃарЃўрЃърЃбрЃА (`hooks/auth-hook.sh`), рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЊрЃарЃЮрЃћрЃЉрЃўрЃЌ рЃљрЃЏрЃљрЃбрЃћрЃЉрЃА `_acme-challenge` TXT рЃЕрЃљрЃюрЃљрЃгрЃћрЃарЃА рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃАрЃў рЃЊрЃЮрЃЏрЃћрЃюрЃўрЃА BIND9 рЃќрЃЮрЃюрЃўрЃА рЃцрЃљрЃўрЃџрЃерЃў.
    * рЃќрЃЮрЃюрЃўрЃА рЃцрЃљрЃўрЃџрЃўрЃА рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА `rndc reload` рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљрЃА DNS рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА рЃњрЃљрЃАрЃљрЃљрЃЦрЃбрЃўрЃБрЃарЃћрЃЉрЃџрЃљрЃЊ.
    * рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃўрЃА рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ, `certbot` рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА `cleanup-hook` рЃАрЃЎрЃарЃўрЃърЃбрЃА (`hooks/cleanup-hook.sh`), рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃерЃџрЃўрЃА рЃЊрЃарЃЮрЃћрЃЉрЃўрЃЌ TXT рЃЕрЃљрЃюрЃљрЃгрЃћрЃарЃА.

4.  **рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃўрЃА рЃњрЃљрЃюрЃљрЃгрЃўрЃџрЃћрЃЉрЃљ (Deployment):**
    * рЃљрЃ«рЃџрЃљрЃЊ рЃњрЃљрЃфрЃћрЃЏрЃБрЃџрЃў рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃў (`fullchain.pem`) рЃЊрЃљ рЃърЃўрЃарЃљрЃЊрЃў рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃў (`privkey.pem`) рЃћрЃарЃЌрЃўрЃљрЃюрЃЊрЃћрЃЉрЃљ рЃћрЃарЃЌ `.pem` рЃцрЃљрЃўрЃџрЃерЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЌрЃљрЃЋрЃАрЃћрЃЉрЃљрЃЊрЃўрЃљ `HAProxy`-рЃАрЃЌрЃљрЃю.
    * рЃњрЃљрЃћрЃарЃЌрЃўрЃљрЃюрЃћрЃЉрЃБрЃџрЃў `.pem` рЃцрЃљрЃўрЃџрЃў `scp`-рЃўрЃА рЃЏрЃћрЃерЃЋрЃћрЃЮрЃЉрЃўрЃЌ рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃЊ рЃўрЃњрЃќрЃљрЃЋрЃюрЃћрЃЉрЃљ рЃДрЃЋрЃћрЃџрЃљ Load Balancer рЃЎрЃЋрЃљрЃюрЃФрЃќрЃћ (`10.0.0.4`, `10.0.0.8`) рЃЊрЃљ рЃЌрЃљрЃЋрЃАрЃЊрЃћрЃЉрЃљ `/etc/haproxy/certs/` рЃЊрЃўрЃарЃћрЃЦрЃбрЃЮрЃарЃўрЃљрЃерЃў.
    * `HAProxy` рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃўрЃљ рЃўрЃАрЃћ, рЃарЃЮрЃЏ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ, рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃЏрЃљрЃюрЃБрЃљрЃџрЃБрЃарЃў рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃўрЃА рЃњрЃљрЃарЃћрЃерЃћ, рЃгрЃљрЃўрЃЎрЃўрЃЌрЃ«рЃЮрЃА рЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃЮрЃА рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџрЃў рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃћрЃЉрЃў рЃљрЃЏ рЃЊрЃўрЃарЃћрЃЦрЃбрЃЮрЃарЃўрЃўрЃЊрЃљрЃю.

---

## 3. рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃЎрЃЮрЃЏрЃърЃЮрЃюрЃћрЃюрЃбрЃћрЃЉрЃў (рЃАрЃЎрЃарЃўрЃърЃбрЃћрЃЉрЃў)

рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃерЃћрЃЊрЃњрЃћрЃЉрЃљ рЃарЃљрЃЏрЃЊрЃћрЃюрЃўрЃЏрЃћ рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃАрЃњрЃљрЃю, рЃЌрЃБрЃЏрЃфрЃљ рЃЮрЃърЃћрЃарЃўрЃарЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА рЃАрЃљрЃГрЃўрЃарЃЮрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃћрЃарЃЌрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃљ.

* **`automation.sh` (рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃАрЃЎрЃарЃўрЃърЃбрЃў):** рЃћрЃА рЃљрЃарЃўрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃЏрЃЏрЃљрЃарЃЌрЃЋрЃћрЃџрЃў рЃАрЃЎрЃарЃўрЃърЃбрЃў. рЃЏрЃўрЃАрЃў рЃърЃљрЃАрЃБрЃ«рЃўрЃАрЃЏрЃњрЃћрЃЉрЃџрЃЮрЃЉрЃљрЃљ рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃЉрЃљрЃќрЃўрЃЊрЃљрЃю рЃЊрЃЮрЃЏрЃћрЃюрЃћрЃЉрЃўрЃА рЃгрЃљрЃЏрЃЮрЃдрЃћрЃЉрЃљ рЃЊрЃљ рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃЏрЃљрЃЌрЃњрЃљрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃўрЃА рЃњрЃљрЃфрЃћрЃЏрЃўрЃАрЃљ рЃЊрЃљ рЃњрЃљрЃюрЃљрЃгрЃўрЃџрЃћрЃЉрЃўрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃўрЃА рЃўрЃюрЃўрЃфрЃўрЃарЃћрЃЉрЃљ. **рЃћрЃА рЃћрЃарЃЌрЃљрЃЊрЃћрЃарЃЌрЃў рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃ«рЃћрЃџрЃўрЃЌ рЃБрЃюрЃЊрЃљ рЃњрЃљрЃўрЃерЃЋрЃљрЃА.**
* **`run.sh` (рЃЏрЃљрЃюрЃБрЃљрЃџрЃБрЃарЃў/рЃАрЃљрЃбрЃћрЃАрЃбрЃЮ рЃАрЃЎрЃарЃўрЃърЃбрЃў):** рЃњрЃљрЃюрЃЎрЃБрЃЌрЃЋрЃюрЃўрЃџрЃўрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃћрЃарЃЌрЃў, рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃЊрЃЮрЃЏрЃћрЃюрЃўрЃА рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃўрЃА рЃњрЃљрЃАрЃљрЃљрЃ«рЃџрЃћрЃЉрЃџрЃљрЃЊ. рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃЊрЃўрЃљрЃњрЃюрЃЮрЃАрЃбрЃўрЃЎрЃўрЃАрЃљ рЃЊрЃљ рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃўрЃА рЃЏрЃўрЃќрЃюрЃўрЃЌ.
* **`hooks/auth-hook.sh` (рЃљрЃЋрЃбрЃЮрЃарЃўрЃќрЃљрЃфрЃўрЃўрЃА рЃАрЃЎрЃарЃўрЃърЃбрЃў):** рЃЊрЃљрЃЏрЃ«рЃЏрЃљрЃарЃћ рЃАрЃЎрЃарЃўрЃърЃбрЃў, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф `certbot` рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА `DNS-01` рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃўрЃА рЃерЃћрЃАрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃџрЃљрЃЊ. рЃЏрЃўрЃАрЃў рЃЊрЃљрЃюрЃўрЃерЃюрЃБрЃџрЃћрЃЉрЃљрЃљ DNS рЃќрЃЮрЃюрЃљрЃерЃў TXT рЃЕрЃљрЃюрЃљрЃгрЃћрЃарЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ.
* **`hooks/cleanup-hook.sh` (рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃўрЃА рЃАрЃЎрЃарЃўрЃърЃбрЃў):** рЃЊрЃљрЃЏрЃ«рЃЏрЃљрЃарЃћ рЃАрЃЎрЃарЃўрЃърЃбрЃў, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф `certbot` рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃарЃљрЃЌрЃљ рЃгрЃљрЃерЃљрЃџрЃЮрЃА рЃЊрЃарЃЮрЃћрЃЉрЃўрЃЌрЃў TXT рЃЕрЃљрЃюрЃљрЃгрЃћрЃарЃў DNS рЃќрЃЮрЃюрЃўрЃЊрЃљрЃю.

---

## 4. рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃўрЃА рЃърЃарЃЮрЃфрЃћрЃЊрЃБрЃарЃљ

рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃњрЃљрЃАрЃљрЃерЃЋрЃћрЃЉрЃљрЃЊ рЃЊрЃљ рЃДрЃЋрЃћрЃџрЃљ рЃАрЃљрЃГрЃўрЃарЃЮ рЃЊрЃЮрЃЏрЃћрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃўрЃА рЃњрЃљрЃАрЃљрЃфрЃћрЃЏрЃљрЃЊ/рЃњрЃљрЃАрЃљрЃљрЃ«рЃџрЃћрЃЉрЃџрЃљрЃЊ, рЃЏрЃўрЃ░рЃДрЃћрЃЋрЃўрЃЌ рЃЦрЃЋрЃћрЃЏрЃЮрЃЌ рЃЏрЃЮрЃфрЃћрЃЏрЃБрЃџ рЃюрЃљрЃЉрЃўрЃ»рЃћрЃЉрЃА.

### 4.1. рЃгрЃўрЃюрЃљрЃърЃўрЃарЃЮрЃЉрЃћрЃЉрЃў

* SSH рЃгрЃЋрЃЊрЃЮрЃЏрЃљ рЃФрЃўрЃарЃўрЃЌрЃљрЃЊ DNS рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ (`109.199.103.52` рЃљрЃю `37.60.232.227`).
* `root` рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃърЃарЃўрЃЋрЃўрЃџрЃћрЃњрЃўрЃћрЃЉрЃў рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ.

### 4.2. рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃўрЃА рЃюрЃљрЃЉрЃўрЃ»рЃћрЃЉрЃў

1.  **рЃАрЃћрЃарЃЋрЃћрЃарЃЌрЃљрЃю рЃЊрЃљрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃљ:**
    ```bash
    ssh root@109.199.103.52
    ```

2.  **рЃАрЃљрЃЏрЃБрЃерЃљрЃЮ рЃЊрЃўрЃарЃћрЃЦрЃбрЃЮрЃарЃўрЃљрЃерЃў рЃњрЃљрЃЊрЃљрЃАрЃЋрЃџрЃљ:**
    ```bash
    cd /opt/sslify
    ```

3.  **рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃљ:**
    ```bash
    sudo bash automation.sh
    ```

рЃърЃарЃЮрЃфрЃћрЃАрЃўрЃА рЃЊрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃЊрЃљрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА рЃЏрЃБрЃерЃљрЃЮрЃЉрЃљрЃА. рЃбрЃћрЃарЃЏрЃўрЃюрЃљрЃџрЃерЃў рЃњрЃљрЃЏрЃЮрЃбрЃљрЃюрЃўрЃџрЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ рЃљрЃАрЃљрЃ«рЃљрЃЋрЃА рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЊрЃћрЃњрЃћрЃЉрЃА.

### 4.3. рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃў рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃўрЃќрЃљрЃфрЃўрЃљ (Cron Job)

рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃўрЃќрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ Cron Job-рЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃърЃћрЃарЃўрЃЮрЃЊрЃБрЃџрЃљрЃЊ (рЃЏрЃљрЃњ. рЃДрЃЮрЃЋрЃћрЃџ рЃдрЃљрЃЏрЃћ) рЃњрЃљрЃБрЃерЃЋрЃћрЃЉрЃА рЃЏрЃЏрЃљрЃарЃЌрЃЋрЃћрЃџ рЃАрЃЎрЃарЃўрЃърЃбрЃА.

рЃњрЃљрЃ«рЃАрЃћрЃюрЃўрЃЌ `crontab` рЃарЃћрЃЊрЃљрЃЦрЃбрЃЮрЃарЃў:
```bash
sudo crontab -e
```

рЃЊрЃљ рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћрЃЌ рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃ«рЃљрЃќрЃў:

```
0 3 * * * /usr/bin/sudo /bin/bash /opt/sslify/automation.sh > /var/log/ssl_automation_daily.log 2>&1
```

рЃћрЃА рЃЕрЃљрЃюрЃљрЃгрЃћрЃарЃў рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃА рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃа рЃњрЃљрЃерЃЋрЃћрЃЉрЃљрЃА рЃДрЃЮрЃЋрЃћрЃџ рЃдрЃљрЃЏрЃћ, **03:00** рЃАрЃљрЃљрЃЌрЃќрЃћ. рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЊрЃћрЃњрЃћрЃЉрЃў рЃЕрЃљрЃўрЃгрЃћрЃарЃћрЃЉрЃљ `/var/log/ssl_automation_daily.log` рЃцрЃљрЃўрЃџрЃерЃў.

## 5. рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃљ рЃЊрЃљ рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃњрЃЋрЃљрЃарЃћрЃЉрЃљ

### 5.1. рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃА рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃљ
 * рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџрЃў (Output): рЃЊрЃљрЃљрЃЎрЃЋрЃўрЃарЃЊрЃўрЃЌ рЃбрЃћрЃарЃЏрЃўрЃюрЃљрЃџрЃерЃў рЃњрЃљрЃЏрЃЮрЃбрЃљрЃюрЃўрЃџ рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃћрЃЉрЃА. рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў, рЃњрЃљрЃЏрЃЮрЃЕрЃюрЃЊрЃћрЃЉрЃљ рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃАрЃў рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃћрЃЉрЃў рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃћрЃЉрЃўрЃА рЃЎрЃЮрЃърЃўрЃарЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃљрЃ«рЃћрЃЉ.
 * рЃцрЃљрЃўрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ Load Balancer-рЃќрЃћ: рЃерЃћрЃЊрЃўрЃЌ LB рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ рЃЊрЃљ рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЌ рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃАрЃў .pem рЃцрЃљрЃўрЃџрЃўрЃА рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃўрЃА рЃЌрЃљрЃарЃўрЃдрЃў `/etc/haproxy/certs/` рЃЊрЃўрЃарЃћрЃЦрЃбрЃЮрЃарЃўрЃљрЃерЃў `ls -l` рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃЌ.
 * рЃЋрЃћрЃЉ-рЃЉрЃарЃљрЃБрЃќрЃћрЃарЃўрЃЌ рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ: рЃњрЃљрЃ«рЃАрЃћрЃюрЃўрЃЌ рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃарЃў рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџрЃў рЃЊрЃЮрЃЏрЃћрЃюрЃў рЃЉрЃарЃљрЃБрЃќрЃћрЃарЃерЃў рЃЊрЃљ рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЌ SSL рЃАрЃћрЃарЃбрЃўрЃцрЃўрЃЎрЃљрЃбрЃўрЃА рЃЏрЃЮрЃЦрЃЏрЃћрЃЊрЃћрЃЉрЃўрЃА рЃЋрЃљрЃЊрЃљ.

### 5.2. рЃерЃћрЃАрЃљрЃФрЃџрЃЮ рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃћрЃЉрЃў рЃЊрЃљ рЃџрЃЮрЃњрЃћрЃЉрЃў
 * DNS рЃњрЃљрЃЋрЃарЃфрЃћрЃџрЃћрЃЉрЃљ: рЃЌрЃБ auth-hook рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃЋрЃћрЃа рЃљрЃ«рЃћрЃарЃ«рЃћрЃЉрЃА DNS рЃЕрЃљрЃюрЃљрЃгрЃћрЃарЃўрЃА рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃљрЃА, рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЌ рЃџрЃЮрЃњ рЃцрЃљрЃўрЃџрЃў /var/log/sslify-auth.log.
 * BIND9 рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ: рЃЌрЃБ rndc reload рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃЋрЃћрЃа рЃАрЃарЃБрЃџрЃЊрЃћрЃЉрЃљ, рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЌ BIND9-рЃўрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃБрЃарЃў рЃџрЃЮрЃњрЃћрЃЉрЃў (journalctl -u bind9).
 * Firewall/рЃЦрЃАрЃћрЃџрЃўрЃА рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ: рЃЌрЃБ scp рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃЋрЃћрЃа рЃљрЃ«рЃћрЃарЃ«рЃћрЃЉрЃА рЃцрЃљрЃўрЃџрЃћрЃЉрЃўрЃА рЃЎрЃЮрЃърЃўрЃарЃћрЃЉрЃљрЃА, рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃЊрЃўрЃЌ, рЃарЃЮрЃЏ DNS рЃАрЃћрЃарЃЋрЃћрЃарЃАрЃљ рЃЊрЃљ Load Balancer-рЃћрЃЉрЃА рЃерЃЮрЃарЃўрЃА рЃЦрЃАрЃћрЃџрЃБрЃарЃў рЃгрЃЋрЃЊрЃЮрЃЏрЃљ рЃЊрЃљрЃерЃЋрЃћрЃЉрЃБрЃџрЃўрЃљ 22-рЃћ рЃърЃЮрЃарЃбрЃќрЃћ.


## 6. рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљ рЃЊрЃљ рЃЏрЃљрЃдрЃљрЃџрЃў рЃ«рЃћрЃџрЃЏрЃўрЃАрЃљрЃгрЃЋрЃЊрЃЮрЃЏрЃЮрЃЉрЃљ (High Availability)

рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃЊрЃљрЃърЃарЃЮрЃћрЃЦрЃбрЃћрЃЉрЃБрЃџрЃўрЃљ рЃЎрЃарЃўрЃбрЃўрЃЎрЃБрЃџрЃў рЃЎрЃЮрЃЏрЃърЃЮрЃюрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЊрЃБрЃЉрЃџрЃўрЃарЃћрЃЉрЃўрЃЌ, рЃарЃљрЃЌрЃљ рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃА рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃБрЃгрЃДрЃЋрЃћрЃбрЃЮрЃЉрЃљ рЃЊрЃљ рЃЏрЃљрЃдрЃљрЃџрЃў рЃ«рЃћрЃџрЃЏрЃўрЃАрЃљрЃгрЃЋрЃЊрЃЮрЃЏрЃЮрЃЉрЃљ (High Availability). рЃЦрЃЋрЃћрЃЏрЃЮрЃЌ рЃљрЃдрЃгрЃћрЃарЃўрЃџрЃўрЃљ рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃЎрЃЮрЃЏрЃърЃЮрЃюрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ.


### 6.1. Load Balancers рЃЊрЃљ Keepalived
рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃерЃў рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ рЃЮрЃарЃў **Load Balancer** (`10.0.0.4` рЃЊрЃљ `10.0.0.8`) рЃљрЃЦрЃбрЃўрЃБрЃа/рЃърЃљрЃАрЃўрЃБрЃа рЃарЃћрЃЪрЃўрЃЏрЃерЃў, Keepalived рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃЏрЃћрЃерЃЋрЃћрЃЮрЃЉрЃўрЃЌ.

 - Keepalived рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃЋрЃўрЃарЃбрЃБрЃљрЃџрЃБрЃарЃў IP рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃўрЃА (VIP) рЃерЃћрЃЦрЃЏрЃюрЃљрЃА, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЊрЃўрЃюрЃљрЃЏрЃўрЃБрЃарЃљрЃЊ рЃћрЃюрЃўрЃГрЃћрЃЉрЃљ рЃћрЃарЃЌ-рЃћрЃарЃЌ Load Balancer-рЃА.
 - рЃюрЃЮрЃарЃЏрЃљрЃџрЃБрЃа рЃарЃћрЃЪрЃўрЃЏрЃерЃў, рЃЏрЃЌрЃћрЃџрЃў рЃбрЃарЃљрЃцрЃўрЃЎрЃў рЃЏрЃўрЃћрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ рЃФрЃўрЃарЃўрЃЌрЃљрЃЊ (MASTER) рЃЉрЃљрЃџрЃљрЃюрЃАрЃћрЃарЃќрЃћ.
 - рЃЌрЃБ рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃЉрЃљрЃџрЃљрЃюрЃАрЃћрЃарЃў рЃњрЃљрЃўрЃЌрЃўрЃерЃћрЃЉрЃљ, Keepalived рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃњрЃљрЃЊрЃљрЃљрЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃћрЃЉрЃА рЃЋрЃўрЃарЃбрЃБрЃљрЃџрЃБрЃа IP-рЃА рЃАрЃљрЃарЃћрЃќрЃћрЃарЃЋрЃЮ (BACKUP) рЃЉрЃљрЃџрЃљрЃюрЃАрЃћрЃарЃќрЃћ.
 - рЃћрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃў рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃАрЃЌрЃЋрЃўрЃА рЃерЃћрЃБрЃЏрЃЕрЃюрЃћрЃЋрЃћрЃџрЃўрЃљ рЃЊрЃљ рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃБрЃгрЃДрЃЋрЃћрЃбрЃЮрЃЉрЃљрЃА.

### 6.2. рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃЉрЃљрЃќрЃўрЃА рЃарЃћрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃљ

рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃЉрЃљрЃќрЃћрЃЉрЃў (`10.0.0.7` рЃЊрЃљ `10.0.0.3`) рЃЏрЃБрЃерЃљрЃЮрЃЉрЃћрЃю Master-Master рЃарЃћрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃўрЃА рЃарЃћрЃЪрЃўрЃЏрЃерЃў.

 - **Master-Master** рЃарЃћрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃљ рЃюрЃўрЃерЃюрЃљрЃЋрЃА, рЃарЃЮрЃЏ рЃЮрЃарЃўрЃЋрЃћ рЃЉрЃљрЃќрЃўрЃА рЃАрЃћрЃарЃЋрЃћрЃарЃў рЃљрЃарЃўрЃА рЃљрЃЦрЃбрЃўрЃБрЃарЃў, рЃерЃћрЃБрЃФрЃџрЃўрЃљ рЃЏрЃўрЃўрЃдрЃЮрЃА рЃарЃЮрЃњрЃЮрЃарЃф рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃўрЃА, рЃљрЃАрЃћрЃЋрЃћ рЃЕрЃљрЃгрЃћрЃарЃўрЃА рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃћрЃЉрЃў.
 - рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃа рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ рЃњрЃљрЃюрЃ«рЃЮрЃарЃфрЃўрЃћрЃџрЃћрЃЉрЃБрЃџрЃў рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃљ (рЃЏрЃљрЃњ. рЃљрЃ«рЃљрЃџрЃў WAF рЃгрЃћрЃАрЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ) рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃАрЃўрЃюрЃЦрЃарЃЮрЃюрЃўрЃќрЃЊрЃћрЃЉрЃљ рЃЏрЃћрЃЮрЃарЃћ рЃАрЃћрЃарЃЋрЃћрЃарЃЌрЃљрЃю.
 - рЃћрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ рЃљрЃарЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃљрЃАрЃџрЃўрЃА рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃљрЃА, рЃљрЃарЃљрЃЏрЃћрЃЊ рЃљрЃЏрЃфрЃўрЃарЃћрЃЉрЃА рЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃљрЃА рЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃарЃўрЃфрЃ«рЃљрЃЋрЃА рЃћрЃарЃЌрЃў рЃгрЃћрЃарЃбрЃўрЃџрЃўрЃА рЃњрЃљрЃЌрЃўрЃерЃЋрЃўрЃА рЃарЃўрЃАрЃЎрЃА (Single Point of Failure).

## 7. рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃњрЃќрЃљ (End-to-End Request Flow)

рЃћрЃА рЃАрЃћрЃЦрЃфрЃўрЃљ рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃљрЃЊ рЃљрЃдрЃгрЃћрЃарЃА рЃўрЃЏ рЃАрЃарЃБрЃџ рЃњрЃќрЃљрЃА, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ рЃњрЃљрЃЊрЃўрЃА WAF-рЃўрЃА рЃўрЃюрЃцрЃарЃљрЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљрЃерЃў.

1. **DNS рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ**: рЃЎрЃџрЃўрЃћрЃюрЃбрЃў рЃАрЃљрЃЎрЃБрЃЌрЃљрЃарЃў рЃЊрЃЮрЃЏрЃћрЃюрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃўрЃА рЃърЃљрЃюрЃћрЃџрЃерЃў рЃБрЃЌрЃўрЃЌрЃћрЃЉрЃА рЃЕрЃЋрЃћрЃюрЃА DNS Name рЃАрЃћрЃарЃЋрЃћрЃарЃћрЃЉрЃА (ns1.csg.ge, ns2.csg.ge). рЃЕрЃЋрЃћрЃюрЃў рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃърЃћрЃарЃўрЃЮрЃЊрЃБрЃџрЃљрЃЊ рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃљрЃЏ рЃЕрЃљрЃюрЃљрЃгрЃћрЃарЃўрЃА рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃљрЃА, рЃарЃљрЃЌрЃљ рЃЏрЃЮрЃ«рЃЊрЃћрЃА рЃЊрЃЮрЃЏрЃћрЃюрЃўрЃА рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃљ.

2. **рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃўрЃА рЃўрЃюрЃўрЃфрЃўрЃарЃћрЃЉрЃљ**: рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃў рЃ«рЃАрЃюрЃўрЃА рЃЌрЃљрЃЋрЃўрЃА рЃЊрЃЮрЃЏрЃћрЃюрЃА (example.com) рЃЉрЃарЃљрЃБрЃќрЃћрЃарЃерЃў.

3. **DNS рЃарЃћрЃќрЃЮрЃџрЃБрЃфрЃўрЃљ**: рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ рЃўрЃњрЃќрЃљрЃЋрЃюрЃћрЃЉрЃљ рЃЕрЃЋрЃћрЃюрЃА DNS рЃАрЃћрЃарЃЋрЃћрЃарЃћрЃЉрЃЌрЃљрЃю (10.0.0.1, 10.0.0.9), рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃћрЃю Load Balancer -рЃўрЃА рЃњрЃџрЃЮрЃЉрЃљрЃџрЃБрЃа рЃЋрЃўрЃарЃбрЃБрЃљрЃџрЃБрЃа IP рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃА (VIP).

4. **Load Balancer**: рЃбрЃарЃљрЃцрЃўрЃЎрЃў рЃ«рЃЋрЃЊрЃћрЃЉрЃљ рЃљрЃЦрЃбрЃўрЃБрЃа Load Balancer-рЃќрЃћ (10.0.0.4 рЃљрЃю 10.0.0.8).
   - рЃЌрЃБ рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ рЃерЃћрЃЏрЃЮрЃЊрЃўрЃА рЃърЃЮрЃарЃб **80/443**-рЃќрЃћ (HTTP/HTTPS), **HAProxy** рЃњрЃљрЃЊрЃљрЃљрЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃћрЃЉрЃА рЃЏрЃљрЃА WAF (Proxy) рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ (`10.0.0.2` рЃљрЃю `10.0.0.6`).

5. **WAF (Web Application Firewall)**: Python-рЃќрЃћ рЃЊрЃљрЃгрЃћрЃарЃўрЃџрЃў WAF рЃўрЃдрЃћрЃЉрЃА рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљрЃА рЃЊрЃљ рЃўрЃгрЃДрЃћрЃЉрЃА рЃЏрЃўрЃА рЃљрЃюрЃљрЃџрЃўрЃќрЃА.
   - рЃљрЃюрЃљрЃџрЃўрЃќрЃўрЃАрЃЌрЃЋрЃўрЃА, WAF-рЃА рЃАрЃГрЃўрЃарЃЊрЃћрЃЉрЃљ рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃћрЃЉрЃўрЃА рЃгрЃћрЃАрЃћрЃЉрЃў (Rules) рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃЉрЃљрЃќрЃўрЃЊрЃљрЃю.
   - WAF рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃЉрЃљрЃќрЃљрЃАрЃЌрЃљрЃю рЃЊрЃљрЃАрЃљрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃџрЃљрЃЊ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃўрЃАрЃћрЃЋ Load Balancer -рЃўрЃАрЃЎрЃћрЃю рЃЏрЃўрЃћрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ рЃърЃЮрЃарЃб 3306-рЃќрЃћ (MySQL рЃърЃЮрЃарЃбрЃў).


6. **рЃЉрЃљрЃќрЃљрЃАрЃЌрЃљрЃю рЃЎрЃљрЃЋрЃерЃўрЃарЃў**: Load Balancer-рЃў рЃўрЃдрЃћрЃЉрЃА 3306 рЃърЃЮрЃарЃбрЃќрЃћ рЃерЃћрЃЏрЃЮрЃАрЃБрЃџ рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљрЃА рЃЊрЃљ рЃњрЃљрЃЊрЃљрЃљрЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃћрЃЉрЃА рЃЏрЃљрЃА рЃљрЃЦрЃбрЃўрЃБрЃа Master-Master рЃЉрЃљрЃќрЃўрЃА рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ (10.0.0.7 рЃљрЃю 10.0.0.3).

7. **рЃгрЃћрЃАрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ**: WAF рЃўрЃдрЃћрЃЉрЃА рЃгрЃћрЃАрЃћрЃЉрЃА рЃЉрЃљрЃќрЃўрЃЊрЃљрЃю, рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃерЃћрЃЏрЃЮрЃАрЃБрЃџ рЃбрЃарЃљрЃцрЃўрЃЎрЃА рЃЊрЃљ рЃўрЃдрЃћрЃЉрЃА рЃњрЃљрЃЊрЃљрЃгрЃДрЃЋрЃћрЃбрЃўрЃџрЃћрЃЉрЃљрЃА:
   - **рЃЊрЃљрЃЉрЃџрЃЮрЃЎрЃЋрЃљ**: рЃЌрЃБ рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ рЃАрЃљрЃерЃўрЃерЃўрЃљ, WAF рЃЉрЃџрЃЮрЃЎрЃљрЃЋрЃА рЃЏрЃљрЃА.
   - **рЃњрЃљрЃбрЃљрЃарЃћрЃЉрЃљ**: рЃЌрЃБ рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ рЃџрЃћрЃњрЃўрЃбрЃўрЃЏрЃБрЃарЃўрЃљ, WAF рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃЏрЃљрЃА рЃЎрЃџрЃўрЃћрЃюрЃбрЃўрЃА рЃАрЃљрЃЉрЃЮрЃџрЃЮрЃЮ рЃЋрЃћрЃЉ-рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ.

## 8. рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃўрЃА рЃЋрЃўрЃќрЃБрЃљрЃџрЃБрЃарЃў рЃЊрЃўрЃљрЃњрЃарЃљрЃЏрЃљ
рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃБрЃЎрЃћрЃЌ рЃљрЃдрЃАрЃљрЃЦрЃЏрЃћрЃџрЃљрЃЊ, рЃЦрЃЋрЃћрЃЏрЃЮрЃЌ рЃЏрЃЮрЃфрЃћрЃЏрЃБрЃџрЃўрЃљ рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃўрЃА рЃЊрЃўрЃљрЃњрЃарЃљрЃЏрЃљ.

### 8.1. рЃЋрЃћрЃЉ-рЃбрЃарЃљрЃцрЃўрЃЎрЃўрЃА рЃњрЃќрЃљ

```mermaid
graph TD
    Client["­ЪЉеРђЇ­Ъњ╗<br>Client / Browser"]

    subgraph DNS_Cluster ["DNS Cluster (BIND9)"]
        direction LR
        DNS1["ns1.csg.ge<br>IP: 109.199.103.52<br>Internal: 10.0.0.1"]
        DNS2["ns2.csg.ge<br>IP: 37.60.232.227<br>Internal: 10.0.0.9"]
    end

    subgraph Management ["Management & Automation"]
        direction TB
        Admin["­ЪЉеРђЇ­Ъњ╝<br>Admin"]
        Cron["­Ъцќ<br>Cron Job"]
        CP["WAF Control Panel<br>IP: 37.60.232.228<br>Internal: 10.0.0.5<br>PHP/Apache2"]
    end

    subgraph LB_Cluster ["Load Balancer Cluster<br>Public VIP: 94.247.181.191"]
        style LB_Cluster fill:#f9f,stroke:#333,stroke-width:2px
        direction LR
        LB1["Balancer 1<br>IP: 10.0.0.4<br>Haproxy + Keepalived"]
        LB2["Balancer 2<br>IP: 10.0.0.8<br>Haproxy + Keepalived"]
        VIP["Internal VIP<br>10.0.0.100"]
    end

    subgraph WAF_Cluster ["WAF Proxy Cluster"]
        direction LR
        WAF1["WAF 1<br>IP: 10.0.0.2<br>Python/nginx"]
        WAF2["WAF 2<br>IP: 10.0.0.6<br>Python/nginx"]
    end

    subgraph DB_Cluster ["Database Cluster"]
        style DB_Cluster fill:#9f9,stroke:#333,stroke-width:2px
        direction LR
        DB1["MySQL DB 1<br>IP: 10.0.0.7"]
        DB2["MySQL DB 2<br>IP: 10.0.0.3"]
    end

    subgraph SSL_Flow["SSL Automation Flow"]
        direction LR
        A["certbot"]
        B["BIND9 Zone File"]
        C["SSL Certs (.pem)"]
    end

    EndServer["­ЪїЇ<br>Client's End Server"]

    %% Internal Structural Links
    DNS1 <--> DNS2
    Admin -- "Manages" --> CP
    Cron -- "Runs on" --> DNS1
    LB1 -- "Keepalived SYNC" --- LB2
    LB1 -- "Controls" --> VIP
    LB2 -- "Controls" --> VIP
    DB1 -- "Master-Master SYNC" --- DB2
    A -- "Creates<br>DNS-01 Challenge" --> B
    B -- "Reloads" --> DNS1
    A -- "Gets Certs" --> C
    
    %% Main Traffic & Automation Flows
    Client -- "HTTPS / DNS" --> DNS_Cluster
    DNS_Cluster -- "Resolves to VIP" --> LB_Cluster
    LB_Cluster -- "HTTP/S Traffic<br>(Port 80/443)" --> WAF_Cluster
    WAF_Cluster -- "РюЁ ALLOW" --> EndServer
    WAF_Cluster -- "­ЪЏЉ BLOCK" ---x Client
    WAF_Cluster -.->|"DB Query (for Rules)<br>Request via Port 3306"| LB_Cluster
    LB_Cluster -.->|"Forwards Port 3306"| DB_Cluster
    DB_Cluster -.->|"Returns Rules"| LB_Cluster
    LB_Cluster -.->|"Returns to WAF"| WAF_Cluster
    Cron -- "Runs certbot" --> SSL_Flow
    C -- "scp to Balancers" --> LB_Cluster
```

